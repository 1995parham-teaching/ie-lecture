---
index: 2
title: HTTP
topics:
  - Introduction
  - Cookie
  - Proxy & Cache
  - Authentication
---

<section>
  <div class="toc"></div>
</section>
<section>
  <div class="toc" data-selected="0"></div>
</section>
<section>
  <h2>Introduction</h2>
  <ul>
    <li>HTTP is the transfer protocol for web applications</li>
    <ul>
      <li>
        <span class="hl-orange">H</span><span class="hl-green">T</span><span class="hl-yellow">T</span><span class="hl-cyan">P</span>:
        <span class="hl-orange">Hyper</span>
        <span class="hl-green">Text</span>
        <span class="hl-yellow">Transfer</span>
        <span class="hl-cyan">Protocol</span>
      </li>
      <li>HTTP 1.0 (RFC 1945), HTTP 1.1 (RFC 2068), HTTP 2 (RFC 7540)</li>
      <li>In fact, it can be used to transfer everything (not only hyper text)</li>
      <ul>
        <li>Text Documents e.g. HTML, XML, JSON, etc.</li>
        <li>Multimedia e.g. JGP, GIF, MP4, MKV, etc.</li>
        <li>Application e.g. PDF, ZIP, etc.</li>
      </ul>
    </ul>
  </ul>
</section>
<section>
  <h2>Introduction (Cont.)</h2>
  <ul>
    <li>HTTP uses the client/server paradigm</li>
    <ul>
      <li>HTTP server provides resource</li>
      <li>HTTP client (usually web browser) gets resource</li>
    </ul>
    <li>But not pure client/server communication</li>
    <ul>
      <li>Proxies</li>
      <li>Caches</li>
      <li>...</li>
    </ul>
  </ul>
</section>
<section>
  <h2>Introduction (Cont.)</h2>
  <ul>
    <li>HTTP is an <span class="hl-orange">application layer protocol</span></li>
    <li>HTTP assumes reliable communication</li>
    <ul>
      <li>over TCP</li>
      <li>default (server) port: 80</li>
      <li>client port is chosen randomly per connection</li>
    </ul>
    <li>HTTP is <span class="hl-green">Stateless</span></li>
    <ul>
      <li>Server does not keep history/state of client</li>
      <li>High performance &amp; Low Complexity</li>
      <li>Problematic in some applications (sessions)</li>
      <ul>
        <li>Cookies</li>
        <li>JSON Web Tokens</li>
      </ul>
    </ul>
  </ul>
</section>
<section>
  <h2>Data Resources to Transfer</h2>
  <ul>
    <li>HTTP is the protocol to transfer data between server and client (usually from server to client)</li>
    <li>Which data?</li>
    <ul>
      <li>It can be <span class="hl-green">anything</span></li>
      <li>In web, usually, it is a resource/object on server</li>
    </ul>
    <li>Each resource must be <span class="hl-orange">identified</span>/<span class="hl-cyan">located</span> uniquely</li>
    <ul>
      <li>URI (Uniform Resource Identifier)</li>
      <li>URL (Uniform Resource Locator)</li>
    </ul>
    <li>URIs <span class="hl-orange">identify</span> and URLs <span class="hl-cyan">locate</span>; however, locators are also identifiers, so</li>
    <div class="box"><p>every URL is also a URI, but there are URIs which are not URLs.</p></div>
  </ul>
</section>
<section>
  <h2>URL</h2>
  <div class="box"><p>
      <span class="hl-orange">&lt;protocol(scheme)&gt;</span>
      :// &lt;user&gt; : &lt;pass&gt; @ &lt;host&gt; : &lt;
      port&gt; / <span class="hl-green">&lt;path&gt;</span> ? <span class="hl-cyan">&lt;query&gt;</span> # <span class="hl-red">&lt;frag&gt;</span>
  </p></div>
  <ul>
    <li>https://sbu.ac.ir/SitePages/Home.aspx</li>
    <li>https://www.bing.com/search?q=Hello+World&amp;form=QBLH&amp;sp=-1&amp;pq=&amp;sc=0-0&amp;qs=n&amp;sk=&amp;cvid=7F2B496642F94D5F95989756B4FF60EE</li>
    <li>file:///home/parham/Documents/Git/parham/dotfiles</li>
    <li>http://libgen.is</li>
    <li>ftp://speedtest.tele2.net</li>
  </ul>
</section>
<section>
  <h2>URL (Cont.)</h2>
  <ul>
    <li><span class="hl-orange">Scheme</span>: The application layer protocol</li>
    <li>HTTP: The web protocol</li>
    <li>HTTPS: Secure HTTP</li>
    <li>FTP: File Transfer Protocol</li>
    <li>File: Access to a local file</li>
    <li>javascript: Run javascript code</li>
    <li>mailto: Send mail to given address</li>
    <li>etc.</li>
  </ul>
</section>
<section>
  <h2>URL (Cont.)</h2>
  <ul>
    <li><span class="hl-green">Path</span>: The path of the object on host filesystem</li>
    <li>E.g. web server root directory is <code>/var/www/</code></li>
    <ul>
      <li><code>http://www.example.com/1.html</code> &rarr; <code>/var/www/1.html</code></li>
      <li><code>http://www.example.com/1/2/3.jpg</code> &rarr; <code>/var/www/1/2/3.jpg</code></li>
    </ul>
  </ul>
</section>
<section>
  <h2>URL (Cont.)</h2>
  <ul>
    <li><span class="hl-cyan">Query</span>: A mechanism to pass information from client to active pages or forms</li>
    <ul>
      <li>Fill information in a university registration form</li>
      <li>Ask Bing! to search a phrase</li>
    </ul>
    <li>Starts with "?"</li>
    <li><code>name=value</code> format</li>
    <li>"&amp;" is the border between multiple parameters</li>
    <li>Try this out, by <a href="https://httpbin.org/get?name=Parham&family=Alvani">clicking me</a></li>
  </ul>
  <div class="box">
    <h3>HTTPBin</h3>
    <p>A simple HTTP Request &amp; Response Service.</p>
  </div>
</section>
<section>
  <h2>URL (Cont.)</h2>
  <ul>
    <li><span class="hl-red">Frag</span>: A name for a part of resource</li>
    <ul>
      <li>A section in a document</li>
    </ul>
    <li>Handled by browser</li>
    <ul>
      <li>Browser gets whole resource (doc) from server</li>
      <li>In display time, it jumps to the specific part</li>
    </ul>
    <li>Try this out, by <a href="https://github.com/gopasspw/gopass/#introduction">clicking me</a></li>
  </ul>
</section>
<section>
  <h2>URL (Cont.)</h2>
  <ul>
    <li><span class="hl-orange">Domain names</span> are <span class="hl-green">case insensitive</span> according to RFC 4343.</li>
    <li>The rest of URL is sent to the server via the GET method and etc.
      <q>This <span class="hl-yellow">may be</span> case sensitive or not.</q></li>
  </ul>
</section>
<section>
  <h2>URL (Cont.)</h2>
  <ul>
    <li>URL is encoded by client before transmission</li>
    <li>How: Each byte is divided into two 4-bit group, hexadecimal of the 4-bits are prefixed by %</li>
    <ul>
      <li><code>~</code> &rarr; <code>126</code> &rarr; <code>%7E</code></li>
    </ul>
    <li>What &amp; Why?</li>
    <ul>
      <li>Non-ASCII (e.g., Persian Characters, Emoji)</li>
      <li>Reserved character when are not used for special role</li>
      <li>Unsafe character, e.g. space, %, ...</li>
    </ul>
    <div class="box">
      <p>https://ganj.irandoc.ac.ir/api/v1/search/main?keywords=hellow%20world</p>
    </div>
  </ul>
</section>
<section>
  <section class="hands-on">
    <h2>URL in Action</h2>
    <ul>
      <li>User asks the browser to retrieve a resource</li>
      <li>Browser finds the ip address of &lt;host&gt; (DNS lookup)</li>
    </ul>
  </section>
  <section>
    <ul>
      <li>Browser creates a TCP connection to the IP address and the &lt;port&gt;</li>
      <li>Browser sends http requests throught the connection</li>
      <li>Browser gets the response and processes it</li>
    </ul>
  </section>
</section>
<section>
  <h2>URL in Action (Cont.)</h2>
  <pre><code>
2950	113.658623720	192.168.73.191	3.220.112.94	TCP	74	59890 â†’ 80 [SYN] Seq=0 Win=64240 Len=0 MSS=1460 SACK_PERM=1 TSval=335902154 TSecr=0 WS=128
2956	113.848038152	3.220.112.94	192.168.73.191	TCP	74	80 â†’ 59890 [SYN, ACK] Seq=0 Ack=1 Win=26847 Len=0 MSS=1460 SACK_PERM=1 TSval=1360379473 TSecr=335902154 WS=256
2957	113.848146169	192.168.73.191	3.220.112.94	TCP	66	59890 â†’ 80 [ACK] Seq=1 Ack=1 Win=64256 Len=0 TSval=335902344 TSecr=1360379473
2958	113.848626070	192.168.73.191	3.220.112.94	HTTP	503	GET /bytes/1378 HTTP/1.1
2962	114.079894429	3.220.112.94	192.168.73.191	TCP	66	80 â†’ 59890 [ACK] Seq=1 Ack=438 Win=28160 Len=0 TSval=1360379525 TSecr=335902344
2963	114.080912334	3.220.112.94	192.168.73.191	HTTP	1683	HTTP/1.1 200 OK
2964	114.080950090	192.168.73.191	3.220.112.94	TCP	66	59890 â†’ 80 [ACK] Seq=438 Ack=1618 Win=62720 Len=0 TSval=335902576 TSecr=1360379526
  </code></pre>
</section>
<section>
  <h2>How does HTTP work? <span class="hl-red">Transactions</span></h2>
  <ul>
    <li>HTTP data transfer is a collection of transactions</li>
    <li>Each transaction is composed of 2 HTTP messages</li>
    <li>Requests are identified by methods</li>
    <ul>
      <li><span class="hl-orange">Method</span>: The action that client asks from server</li>
    </ul>
    <li>Responses are identified by status codes</li>
    <ul>
      <li><span class="hl-green">Status</span>: The result of the requested action</li>
    </ul>
  </ul>
</section>
<section>
  <h2>HTTP Transactions</h2>
  <img src="./img/http-transactions.png" height="500px" alt="http-transactions">
</section>
<section>
  <h2>HTTP Transactions in Web</h2>
  <ul>
    <li>(Tipically) each web page contains multiple resources</li>
    <ul>
      <li>The main skeleton HTML page</li>
      <li>Some linked materials: figures, videos, JS, CSS, etc.</li>
    </ul>
    <li>Displaying a web page by a browser</li>
    <ul>
      <li>Get the HTML page (first transaction)</li>
      <li>Try to display the page (redering)</li>
      <li>Other resources are linked to the page</li>
      <li>Get the resources (subsequent transactions)</li>
    </ul>
  </ul>
</section>
<section>
  <h2>HTTP Transactions in Web (Cont.)</h2>
  <ul>
    <li>HTTP Transactions &amp; TCP Connections</li>
    <ol>
      <li><span class="hl-orange">Non-persistent</span></li>
      <ul>
        <li>A new TCP connection per object</li>
        <li>Network overhead + Connection establish delay + Resource intesive</li>
        <li>Parallel connections speed up browsing</li>
      </ul>
      <li><span class="hl-green">Persistent</span></li>
      <ul>
        <li>Get multiple objects using a single TCP connection</li>
        <li>No extra processing &amp; networking overhead</li>
        <li>Poor performance if implemented in serial manner</li>
        <li>Pipeline requests speed up browsing (HTTP/1.1)</li>
      </ul>
    </ol>
  </ul>
</section>
<section>
  <h2>HTTP/2 for a Faster Web</h2>
  <h3>HTTP Pipelining</h3>
  <ul>
    <li>HTTP Pipelining is <span class="hl-green">not difficult to deploy</span>, <span class="hl-orange">it is impossible.</span></li>
    <li>it still allowed a single large or slow response to block all others that followed.</li>
  </ul>
  <h3>HTTP/2 Multiplexing</h3>
  <ul>
    <li>Multiplexing allows multiple request-response messages to be in flight over a single HTTP/2 connection, at the same time.</li>
  </ul>
</section>
<section>
  <h2>HTTP/2 for a Faster Web (Cont.)</h2>
  <img src="./img/http2-transactions.png" height="500px" alt="http2-transactions">
</section>
<section class="hands-on">
  <h2>HTTP Transactions in Web: Hands on</h2>
  <ul>
    <li>Get a HTML page from a server</li>
    <li>Capture the packets</li>
    <li>Investigate the transactions</li>
  </ul>
</section>
<section>
  <h2>HTTP Messages</h2>
  <ul>
    <li>HTTP is <span class="hl-orange">text-based</span> protocol</li>
    <ul>
      <li>Human readable headers</li>
      <li>The header is composed of some lines</li>
    </ul>
  </ul>
  <img src="./img/message-structure.jpg" alt="message-structure" height="400px">
</section>
<section>
  <section>
    <h2>HTTP Messages (Cont.)</h2>
    <ul>
      <li>E.g. HTTP request message</li>
    </ul>
    <pre><code class="language-http">
GET /index.html HTTP/1.1
Host: www.aut.ac.ir
User-Agent: Mozilla/36.0
Accept-Language: en-us
Connection: keep-alive
    </code></pre>
  </section>
  <section>
    <pre><code class="plaintext">
Method&lt;sp&gt;Path&lt;sp&gt;Version&lt;CRLF&gt;
Header-Field:Header-Value&lt;CRLF&gt;
...
Header-Field:Header-Value&lt;CRLF&gt;
&lt;CRLF&gt;
Entity-Body
    </code></pre>
  </section>
  <section>
    <ul>
      <li>E.g. HTTP response message</li>
    </ul>
    <pre><code class="language-http">
HTTP/1.1 200 OK
Date: Sun, 02 Oct 2018 20:30:40
Server: Apache/2.2.2
Last-Modified: Mon, 03 May 2017 10:20:22
Connection: keep-alive
Content-Length: 3000

data data data ...
    </code></pre>
  </section>
  <section>
    <pre><code class="plaintext">
Version&lt;sp&gt;Code&lt;sp&gt;Reason&lt;CRLF&gt;
Header-Field:Header-Value&lt;CRLF&gt;
...
Header-Field:Header-Value&lt;CRLF&gt;
&lt;CRLF&gt;
Entity-Body
    </code></pre>
  </section>
</section>
<section>
  <section>
    <h2>HTTP Methods</h2>
    <ul>
      <li>Methods are actions that client asks from server to do on the specified resource (given by the path parameter)</li>
      <li>Which actions?</li>
      <ul>
        <li>Basic data communication operations</li>
        <ul>
          <li><span class="hl-orange">Safe</span> operations</li>
          <ul>
            <li>Get a resource from server</li>
            <li>Send data to server</li>
          </ul>
          <li><span class="hl-green">Unsafe</span> operations</li>
          <ul>
            <li>Delete a resource on server</li>
            <li>Create/Replace a resource on server</li>
          </ul>
        </ul>
      </ul>
    </ul>
  </section>
  <section>
    <ul>
      <ul>
        <li>Debugging and troubleshooting</li>
        <ul>
          <li>Get information about a resource</li>
          <li>Check what the server has got from a client</li>
          <li>Get the list of operations which can be applied on a resource</li>
        </ul>
      </ul>
    </ul>
  </section>
</section>
<section>
  <h2>HTTP Methods (Cont.)</h2>
  <ul>
    <li><span class="hl-orange">GET</span>: Retrieve resource from server</li>
    <li><span class="hl-orange">HEAD</span>: Simlar to GET but the resource itself is not retrieved, just the HTTP response header</li>
    <ul>
      <li>Useful for debugging or some other applications</li>
    </ul>
    <li><span class="hl-orange">POST</span>: Submit data to be processed by the specified resource</li>
    <ul>
      <li>Data itself is enveloped in message body</li>
    </ul>
  </ul>
</section>
<section>
  <h2>HTTP Methods (Cont.)</h2>
  <ul>
    <li><span class="hl-green">DELETE</span>: Remove the resource</li>
    <ul>
      <li>Not popular in web, can be used in other applications</li>
    </ul>
    <li><span class="hl-green">PUT</span>: Add message body as the specified resource to server</li>
    <li><span class="hl-green">TRACE</span>: Server echoes back the recieved message</li>
    <ul>
      <li>For troubleshooting &amp; debugging</li>
    </ul>
    <li><span class="hl-green">OPTIONS</span>: Request the list of supported methods by server on the resource</li>
  </ul>
</section>
<section>
  <h2>HTTP Responses</h2>
  <ul>
    <li>The message for the result/response of the requested action</li>
    <li>Which responses?</li>
    <ul>
      <li>Basic responses</li>
      <ul>
        <li><span class="hl-green">Success</span></li>
        <li><span class="hl-red">Failure</span></li>
        <ul>
          <li>Bad client request</li>
          <li>Server problem</li>
          <li>...</li>
        </ul>
      </ul>
      <li>Others</li>
      <ul>
        <li>E.g., Redirection to other resources</li>
      </ul>
    </ul>
  </ul>
</section>
<section>
  <h2>HTTP Responses (Cont.)</h2>
  <ul>
    <li><span class="hl-green">2xx</span></li>
    <ul>
      <li>200: OK</li>
      <li>201: Created</li>
      <li>204: No Content</li>
    </ul>
    <li><span class="hl-yellow">4xx</span></li>
    <ul>
      <li>400: Bad Request</li>
      <li>401: Unauthorized (Authorization required)</li>
      <li>403: Forbidden</li>
      <li>404: Not Found</li>
      <li>405: Method Not Allowed</li>
    </ul>
  </ul>
</section>
<section>
  <h2>HTTP Responses (Cont.)</h2>
  <ul>
    <li><span class="hl-red">5xx</span></li>
    <ul>
      <li>500: Internal Server Error</li>
      <li>501: Not Implemented</li>
      <li>503: Service Unavailable</li>
    </ul>
    <li><span class="hl-cyan">3xx</span></li>
    <ul>
      <li>301: Moved Permanently</li>
      <li>307: Moved Temporarily</li>
      <ul>
        <li>Resource has been moved, Redirection</li>
        <li>Location header contains the new location of resource</li>
      </ul>
      <li>304: Not Modified</li>
    </ul>
  </ul>
</section>
<section class="hands-on">
  <h2>HTTP Messages Hands on</h2>
  <ul>
    <li>Connect to a web server</li>
    <ul>
      <li>Telnet can create TCP socket</li>
    </ul>
    <li>Play with the server by sending HTTP methods and checking the responses</li>
  </ul>
</section>
<section>
  <h2>HTTP Headers</h2>
  <ul>
    <li>Headers are additional information that is sent by client to server and vice versa</li>
    <ul>
      <li>Most (allmost all) are optional</li>
    </ul>
    <li>Which headers?</li>
    <ul>
      <li>Information about client</li>
      <li>Information about server</li>
      <li>Information about the requested resource</li>
      <li>Information about the response</li>
      <li>Security/Authentication</li>
      <li>...</li>
    </ul>
  </ul>
</section>
<section>
  <h2>HTTP Headers</h2>
  <ul>
    <li><span class="hl-orange">General</span> headers</li>
    <ul>
      <li>Appear both on request &amp; response messages</li>
    </ul>
    <li><span class="hl-green">Request</span> headers</li>
    <ul>
      <li>Information about request</li>
    </ul>
    <li><span class="hl-cyan">Response</span> headers</li>
    <ul>
      <li>Information about response</li>
    </ul>
    <li><span class="hl-yellow">Entity</span> headers</li>
    <ul>
      <li>Information about body (size, ...)</li>
    </ul>
    <li><span class="hl-violet">Extension</span> headers</li>
    <ul>
      <li>New headers (not standard)</li>
    </ul>
  </ul>
</section>
<section>
  <h2>General Headers</h2>
  <ul>
    <li><span class="hl-orange">Date</span>: Date &amp; Time that message is created</li>
    <li><span class="hl-green">Connection</span>: Close or Keep-Alive</li>
    <ul>
      <li>Close: Non-persistent connection</li>
      <li>Kepp-Alive: Persistent connection</li>
    </ul>
    <li><span class="hl-yellow">Via</span>: Information about the intermediate nodes between two sides</li>
    <ul>
      <li>Proxy servers</li>
    </ul>
  </ul>
</section>
<section>
  <h2>Request Headers</h2>
  <ul>
    <li><span class="hl-orange">Host</span>: The name of the server (<span class="hl-green">required</span>, why?)</li>
    <li><span class="hl-cyan">Referer</span>: URL that contains requested URL</li>
    <li>Information about the client</li>
    <ul>
      <li><span class="hl-yellow">User-Agent</span>: The client program</li>
      <li><span class="hl-yellow">Accept</span>: The acceptable media types</li>
      <li><span class="hl-yellow">Accept-Encoding</span>: The acceptable encoding</li>
      <li><span class="hl-yellow">Accept-Language</span>: The acceptable language</li>
    </ul>
  </ul>
</section>
<section>
  <h2>Request Headers (Cont.)</h2>
  <ul>
    <li><span class="hl-orange">Range</span>: Specific range (in byte) of resource</li>
    <li><span class="hl-green">Authorization</span>: Response to the authenticate</li>
    <ul>
      <li>Will be discussed later</li>
    </ul>
    <li><span class="hl-yellow">Cookie</span>: To return back the cookies</li>
    <ul>
      <li>Will be discussed later</li>
    </ul>
    <li><span class="hl-cyan">If-Modified-Since</span>: Request is processed if the objected is modified since the specified time.</li>
    <ul>
      <li>Used in Web Caching</li>
      <li>Will be discussed later</li>
    </ul>
  </ul>
</section>
<section>
  <h2>Response Header</h2>
  <ul>
    <li><span class="hl-orange">Server</span>: Information about server</li>
    <li><span class="hl-green">WWW-Authenticate</span>: Used to specify authentication parameters by server</li>
    <li><span class="hl-yellow">Proxy-Authenticate</span>: Used to specify authentication parameters by proxy</li>
    <li><span class="hl-cyan">Set-Cookie</span>: To send a cookie to client</li>
    <li><span class="hl-red">Location</span>: The location of entity to redirect client</li>
  </ul>
</section>
<section>
  <h2>Response Header (Cont.)</h2>
  <ul>
    <li><span class="hl-orange">Last-Modified</span>: The date and time of last modification of entity</li>
    <li><span class="hl-green">Content-Range</span>: Range of this entity in the entire resource</li>
    <li><span class="hl-cyan">Expires</span>: The date and time at which the entity will expire</li>
  </ul>
</section>
<section>
  <h2>Entity Headers</h2>
  <ul>
    <li><span class="hl-orange">Content-Length</span>: The length of body (in byte)</li>
    <li><span class="hl-green">Content-Type</span>: The type of entity</li>
    <ul>
      <li>MIME types: text/xml, image/gif</li>
      <li>Check <a href="https://api.sahebcloud.ir/api/v1/slide/photo/5f691500beaad9694413b8f1">here</a></li>
    </ul>
    <li><span class="hl-red">Allow</span>: The allowed request methods can be performed on the entity</li>
    <ul>
      <li>This is in response of OPTIONS method</li>
    </ul>
  </ul>
</section>
<section>
  <h2>Extension Headers</h2>
  <ul>
    <li>Custom proprietary headers have <span class="hl-orange">historically</span> been used with an <span class="hl-green">X-</span> prefix, but this convention was <span class="hl-yellow">deprecated</span> in June 2012</li>
    <li>implementation-specific and private-use parameters could at least incorporate the organization's name</li>
    <ul>
      <li>ExampleInc-foo</li>
      <li>VND.ExampleInc.foo (vnd stands for vendor)</li>
    </ul>
    <li>or primary domain name</li>
    <ul>
      <li>com.example.foo</li>
      <li>http://example.com/foo</li>
    </ul>
  </ul>
</section>
<section>
  <h2>HTTP Tools</h2>
  <ul>
    <li><a href="https://curl.haxx.se/">cURL</a></li>
    <li><a href="https://www.postman.com/">Postman</a></li>
    <li><a href="https://hoppscotch.io/">Hoppscotch</a></li>
    <li><a href="https://httpie.org/">HTTPie</a></li>
  </ul>
</section>
<section>
  <div class="toc" data-selected="1"></div>
</section>
<section>
  <h2>Stateless Problem</h2>
  <ul>
    <li>HTTP is a <span class="hl-orange">stateless</span> protocol</li>
    <ul>
      <li>Server does not remember its client</li>
    </ul>
    <li>How to personalize pages (persoanl portal)?</li>
    <ul>
      <li>Use http header: X-Forwarded-For</li>
      <ul>
        <li>Is not usually sent by browsers</li>
      </ul>
      <li>Find client IP address from TCP connection</li>
      <ul>
        <li>The problem is <span class="hl-green">NAT</span></li>
      </ul>
      <li>Clients move but IP address does not</li>
    </ul>
  </ul>
</section>
<section>
  <h2>Solution of Stateless Problem: Cookie</h2>
  <ul>
    <li>Cookie: are information (e.g. unique identfiers) sent by server to user (browser) which are returned back to server</li>
    <li>How it works</li>
    <ul>
      <li>Server asks client to remember the information</li>
      <ul>
        <li><span class="hl-orange">Set-Cookie</span> header in response message</li>
      </ul>
      <li>Client gives back the information to server in every request</li>
      <ul>
        <li><span class="hl-green">Cookie</span> header in request messages</li>
      </ul>
      <li>Server customizes responses according to the cookie</li>
    </ul>
    <li>Types</li>
    <ul>
      <li>Session cookies: To identify a session</li>
      <li>Persistent cookies: To identify a client (browser)</li>
    </ul>
  </ul>
</section>
<section>
  <section>
    <h2>Cookies (Cont.)</h2>
    <pre><code class="language-http">
GET /cookies/set?name=parham&amp;family=alvani HTTP/1.1
Host: httpbin.org

    </code></pre>
    <pre><code class="language-http">
HTTP/1.1 302 FOUND
Date: Mon, 07 Sep 2020 05:19:50 GMT
Content-Type: text/html; charset=utf-8
Content-Length: 223
Connection: keep-alive
Server: gunicorn/19.9.0
Location: /cookies
Set-Cookie: name=parham; Path=/
Set-Cookie: family=alvani; Path=/
    </code></pre>
  </section>
  <section>
    <pre><code class="language-http">
GET /cookies HTTP/1.1
Host: httpbin.org
Cookie: name=parham; family=alvani
    </code></pre>
    <pre><code class="language-http">
HTTP/1.1 200 OK
Date: Mon, 07 Sep 2020 05:23:53 GMT
Content-Type: application/json
Content-Length: 58
Connection: keep-alive
Server: gunicorn/19.9.0
Access-Control-Allow-Origin: *
Access-Control-Allow-Credentials: true

{
  "cookies": {
    "family": "alvani",
    "name": "parham"
  }
}
    </code></pre>
  </section>
</section>
<section>
  <h2>Cookies (Cont.)</h2>
  <ul>
    <li>Limitation</li>
    <ul>
      <li>Cannot be used to store large data</li>
      <li><span class="hl-orange">At least 300</span> cookies</li>
      <li><span class="hl-green">At least 4096</span> bytes per cookie</li>
      <li><span class="hl-cyan">At least 20</span> cookies per unique host or domain name</li>
    </ul>
    <li>Cookies are text files</li>
    <ul>
      <li>No virus spread</li>
    </ul>
    <li>There is not any request from server to read cookies</li>
    <ul>
      <li>By default cookies are sent by browser</li>
      <li>Browser checks URL and finds appropriate cookies</li>
    </ul>
  </ul>
</section>
<section>
  <h2>Cookies (Cont.)</h2>
  <ul>
    <li>Client can control cookies</li>
    <ul>
      <li>Disable cookies: no cookie is saved &amp; used</li>
      <li>View &amp; Delete cookies</li>
    </ul>
    <li>Server can control cookies by its attributes</li>
    <ul>
      <li>Expiration time</li>
      <li>Domain</li>
      <li>Path</li>
      <li>Security</li>
      <li>...</li>
    </ul>
  </ul>
</section>
<section>
  <section>
    <h2>Cookies Attributes</h2>
    <ul>
      <li><span class="hl-orange">Expire</span> &amp; <span class="hl-green">Max-Age</span>: The life time of the cookie</li>
      <ul>
        <li>Expire: An absolute time to delete cookie</li>
        <li>Max-Age: The maximum life time (sec) of cookie</li>
        <li>If exists, shows a permanent cookie</li>
        <li>Send a past time (or negative) to delete a cookie</li>
      </ul>
      <li><span class="hl-cyan">Secure</span>: Cookie is sent only if channel is secure</li>
      <ul>
        <li>Specially useful for login sessions cookies</li>
        <li>
          A cookie with the Secure attribute is sent to the server only with an encrypted request over the <span class="hl-red">HTTPS protocol</span>,
          never with unsecured <span class="hl-violet">HTTP (except on localhost)</span>, and therefore can't easily be accessed by a man-in-the-middle attacker.
        </li>
      </ul>
    </ul>
  </section>
  <section>
    <ul>
      <li><span class="hl-yellow">HttpOnly</span>: Cookie is sent only if HTTP is used</li>
      <ul>
        <li>JavaScript cannot access to the cookies</li>
      </ul>
    </ul>
  </section>
</section>
<section>
  <section>
    <h2>Cookies Attributes: Domain &amp; Path</h2>
    <ul>
      <li><span class="hl-orange">Domain</span> &amp; <span class="hl-green">Path</span> determine the scope of the cookie</li>
      <ul>
        <li>For which path and domain, the cookie is saved &amp; returned back by browser</li>
      </ul>
      <li>If <span class="hl-orange">Domain</span> is omitted, defaults to the host of the current document URL.</li>
      <ul>
        <li>Browser returns back the cookie for the domain and <span class="hl-red">not</span> <span class="hl-yellow">sub-domains</span></li>
      </ul>
      <li>If <span class="hl-green">Path</span> is omitted, defaults to the path of the current document URL.</li>
      <ul>
        <li>Browser returns back the cookie for the path and also for all sub-paths</li>
      </ul>
    </ul>
  </section>
  <section>
    <ul>
      <li>If present then browser checks validity</li>
      <ul>
        <li>If they are valid then Browser returns back the cookie for that domain &amp; that path and also for all <span class="hl-yellow">sub-domains</span> and <span class="hl-yellow">sub-paths</span></li>
      </ul>
    </ul>
  </section>
</section>
<section>
  <h2>Cookies Attributes: Domain &amp; Path</h2>
  <ul>
    <li>Validity check by major browsers</li>
    <ul>
      <li>Domain names must start with dot</li>
      <ul>
        <li>Some browsers accept names without dot as domain</li>
        <li><span class="hl-orange">Contrary</span> to <span class="hl-green">earlier specifications</span>, leading dots in domain names (.example.com) are ignored.</li>
      </ul>
      <li>Donâ€™t accept for other domains than the base domain</li>
      <li>Donâ€™t accept cookies for sub-domains</li>
      <li>Accept cookies for higher domains</li>
      <ul>
        <li>Except the top level domains, e.g., .com, .ac.ir</li>
      </ul>
      <li>Accept cookies for other (sub or higher) paths</li>
      <ul>
        <li>A path that <span class="hl-violet">must exist</span> in the requested URL, or the browser won't send the Cookie header.</li>
      </ul>
    </ul>
  </ul>
</section>
<section>
  <section>
    <img src="./img/cookies.png" />
  </section>
  <section>
    <img src="./img/sub-domain-cookies.png" />
  </section>
</section>
<section class="hands-on">
  <h2>Cookies Attributes: Domain &amp; Path: Hands on</h2>
  <ul>
  </ul>
</section>
<section>
  <div class="toc" data-selected="2">
  </div>
</section>
<section>
  <section>
    <h2>Proxy</h2>
    <ul>
      <li>Proxies sit between client and server</li>
      <li>Act as server for client</li>
      <li>Act as client for server</li>
    </ul>
    <img src="./img/proxy.png" alt="proxy">
  </section>
  <section>
    <h2>Forward Proxies</h2>
    <ul>
      <li>A forward proxy, or gateway, or just "proxy" provides proxy services to a client or a group of clients.</li>
    </ul>
  </section>
  <section>
    <h2>Reverse Proxies</h2>
    <ul>
      <li>As the name implies, a reverse proxy does the <span class="hl-red">opposite</span> of what a forward proxy does:</li>
      <li>A forward proxy acts in <span class="hl-orange">behalf of clients</span> (or requesting hosts), a reverse proxy acts in <span class="hl-green">behalf of servers</span>.</li>
      <li>Forward proxies can hide the <span class="hl-yellow">identities of clients</span> whereas reverse proxies can hide the <span class="hl-violet">identities of servers</span>.</li>
    </ul>
  </section>
  <section>
    <ul>
      <li>Reverse proxies have several use cases, a few are:</li>
      <ul>
        <li><span class="hl-orange">Load balancing</span>: distribute the load to several web servers,</li>
        <li><span class="hl-green">Cache static content</span>: offload the web servers by caching static content like pictures,</li>
        <li><span class="hl-yellow">Compression</span>: compress and optimize content to speed up load time.</li>
      </ul>
    </ul>
  </section>
  <section>
    <img src="./img/reverse-proxy.png" alt="reverse-proxy">
  </section>
</section>
<section>
  <h2>HTTP Proxy Applications</h2>
  <ul>
    <li>Authentication</li>
    <ul>
      <li>Client side: Authenticate clients before they access web</li>
      <li>Server side: Authenticate clients before access the server</li>
    </ul>
    <li>Accounting: Log client activities</li>
    <li>Security: Analyze request before sending it to server</li>
    <ul>
      <li>Integrated in modern firewalls</li>
    </ul>
    <li>Filtering: Limit access to specified contents</li>
    <li>Anonymizer: Anonymous web browsing</li>
    <li>Caching (more details in the following slide)</li>
  </ul>
</section>
<section>
  <section>
    <h2>Caching</h2>
    <ul>
      <li>Caching: save a copy of a resource and use it instead of requesting server</li>
      <li>Browser has its own local caches</li>
      <li>Cache server is special proxy for caching</li>
      <li>Benefits</li>
      <ul>
        <li>Reduce redundant data transfer</li>
        <li>Reduce network bottleneck</li>
        <li>Reduce load on server</li>
        <li>Reduce delay</li>
      </ul>
    </ul>
  </section>
  <section>
    <img src="./img/http-cache-types.png" style="background-color: white;">
  </section>
</section>
<section>
  <section>
    <h2>Caching Algorithm</h2>
    <ul>
      <li>If the object is not cached, it is got from server, saved in cache, and sent to client</li>
      <li>Else, if object is in cache</li>
      <ul>
        <li>Cache server must return only fresh objects</li>
        <li><span class="hl-red">Freshness check</span></li>
      </ul>
      <li>Objects life-time specified by server</li>
      <li>The <code class="hl-orange">Cache-Control</code> HTTP/1.1 <span class="hl-green">general-header</span> field is used to specify directives for caching mechanisms in <span class="hl-yellow">both requests and responses</span>.</li>
    </ul>
  </section>
  <section>
    <h3>Expiration</h3>
    <p>the maximum amount of time a resource will be considered fresh.</p>
    <pre><code class="language-http">
Cache-Control: max-age=&lt;seconds&gt;
    </code></pre>
    <h3>No caching</h3>
    <p>The cache should not store anything about the client request or server response.</p>
    <pre><code class="language-http">
Cache-Control: no-store
    </code></pre>
  </section>
  <section>
    <h3>Cache but revalidate</h3>
    <p>A cache will send the request to the origin server for validation before releasing a cached copy.</p>
    <pre><code class="language-http">
Cache-Control: no-cache
    </code></pre>
  </section>
  <section>
    <ul>
      <li>If requested object is not expired</li>
      <ul>
        <li>Cache server gives it to client</li>
      </ul>
    </ul>
  </section>
</section>
<section>
  <section>
    <h2>Caching Algorithm (Cont.)</h2>
    <ul>
      <li>If requested object is expired</li>
      <ul>
        <li>Its freshness must be checked</li>
      </ul>
      <li>Freshness is checked by conditional request</li>
      <ul>
        <li><code class="hl-orange">If-Modified-Since</code>: current last-modified time</li>
        <li><code class="hl-green">If-None-Match</code>: the server will send back the requested resource, with a 200 status, only if it doesn't have an ETag matching the given ones.</li>
        <ul>
          <li>The <code class="hl-yellow">ETag</code> HTTP response header is an identifier for a specific version of a resource.</li>
        </ul>
      </ul>
  </section>
  <section>
    <ul>
      <li>Server responses</li>
      <ul>
        <li>304 Not modified response + new expire time</li>
        <ul>
          <li>Cached copy is valid until the specified time</li>
        </ul>
        <li>200 OK</li>
        <ul>
          <li>Server provides a new version of the object</li>
          <li>Cache server updates cached copy</li>
        </ul>
      </ul>
    </ul>
  </section>
  <section>
    <img src="./img/staleness.png" style="background-color: white; height: 50vh;">
  </section>
</section>
<section>
  <div class="toc" data-selected="3"></div>
</section>
<section>
  <h2>HTTP Authentication</h2>
  <ul>
    <li>All resources are not public in web; e.g.,</li>
    <ul>
      <li>Financial documents, Customer information, ...</li>
    </ul>
    <li>HTTP has two (similar) authentications</li>
    <ul>
      <li>Basic: <span class="hl-orange">Base64</span> encoded <code class="hl-yellow">user:pass</code></li>
      <li>Basic: The username itself cannot contain a colon.</li>
      <li>Digest: Plain username + Digest of pass</li>
    </ul>
    <li>Steps are the same</li>
    <ul>
      <li>Client requests resource, Server challenges, Client asks User/Pass, Client responses, Server authenticates and allows</li>
      <li>Authentication information are sent by every request until end of current session</li>
    </ul>
  </ul>
</section>
<section>
  <h2>Base64</h2>
  <ul>
    <li>Base64 is a group of binary-to-text encoding schemes that represent binary data in an ASCII string format by translating it into a radix-64 representation.</li>
  </ul>
  <img src="./img/base64.png">
</section>
<section>
  <h2>HTTP Authentication (Cont.)</h2>
  <pre><code class="language-http">
GET /basic-auth/admin/admin HTTP/1.1
Host: httpbin.org
Authorization: Basic YWRtaW46YWRtaW4=

  </code></pre>
  <pre><code class="language-http">
HTTP/1.1 200 OK
Date: Mon, 07 Sep 2020 14:14:25 GMT
Content-Type: application/json
Content-Length: 48
Connection: keep-alive
Server: gunicorn/19.9.0
Access-Control-Allow-Origin: *
Access-Control-Allow-Credentials: true

{
  "authenticated": true,
  "user": "admin"
}
  </code></pre>
</section>
<section>
  <h2>Digest Authentication</h2>
  <ul>
    <li>Basic authentication is insecure</li>
    <ul>
      <li>Password is sent in base64 encoding</li>
      <li>Attacker can easily find it</li>
    </ul>
    <li>Digest authentication: Donâ€™t send password</li>
    <ul>
      <li>Send its digset (hash)</li>
    </ul>
    <li>Digest/hash function</li>
    <ul>
      <li>One way function, irreversible</li>
    </ul>
    <li>Attacker cannot find password ðŸ˜Œ</li>
    <li>But! Reply attack ðŸ˜ž</li>
    <ul>
      <li>Attacker resends the same digest then he will be authenticated</li>
      <li>Use Nonce</li>
    </ul>
  </ul>
</section>
<section>
  <section>
    <h2>Digest Authentication (Cont.)</h2>
    <ul>
      <li>Client requests a private resource</li>
      <li>Server creates a nonce (the server only issues a new nonce<br>for each <span class="hl-yellow">401</span> response</li>
    </ul>
    <pre><code class="language-http">
  WWW-Authenticate: Digest realm="me@kennethreitz.com", nonce="9e97866f5105eddbf41ce75c4e5e8c14", qop="auth-int", opaque="96f27ba9bad9cd44429b8f4c1b1c060b", algorithm=MD5, stale=FALSE
    </pre></code>
  </section>
  <section>
    <ul>
      <li>Client computes digest of password &amp; nonce</li>
    </ul>
    <pre><code class="plaintext">
  HA1 = MD5(username:realm:password)
  HA2 = MD5(method:digestURI)
  response = MD5(HA1:nonce:HA2)
    </pre></code>
    <ul>
      <li>Server looks up the password of username and computes<br> <code>hash(pass, nonce)</code></li>
      <li>More details in RFC7616</li>
    </ul>
  </section>
</section>
<section>
  <h2>Bearer Authentication</h2>
  <ul>
    <li><span class="hl-orange">Bearer authentication</span> (also called <span class="hl-green">token authentication</span>) is an HTTP authentication scheme that involves security tokens called bearer tokens</li>
    <li>The name <span class="hl-orange">Bearer authentication</span> can be understood as <q class="hl-yellow">give access to the bearer of this token.</q></li>
  </ul>
</section>
<section>
  <section>
    <h2><a href="https://jwt.io/">JWT</a></h2>
    <ul>
      <li>JSON Web Tokens are an <span class="hl-orange">open</span>, <span class="hl-green">industry standard</span> <span class="hl-yellow">RFC 7519</span> method for representing claims securely between two parties.</li>
    </ul>
  </section>
  <section>
    <pre><code class="no-highlight">
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.
eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IlBhcmhhbSBBbHZhbmkiLCJpYXQiOjE1MTYyMzkwMjIsInByb2plY3QiOiJhbiBhd2Vzb21lIHByb2plY3QifQ.
gWWHu5Ps_F6lbqJRBXkNjEk_-0QdLhN9l2MNjWOcj90
    </code></pre>
    <pre><code class="hl-json">
{
  "alg": "HS256",
  "typ": "JWT"
}

{
  "sub": "1234567890",
  "name": "Parham Alvani",
  "iat": 1516239022,
  "project": "an awesome project"
}
    </code></pre>
  </section>
</section>
<section>
  <section>
    <h2>Security</h2>
    <ul>
      <li>Digest authentication protect password only</li>
      <li>Data is completely insecure</li>
      <li>No mechanism in HTTP to protect data</li>
      <li>HTTP over SSL/TLS is the popular solution</li>
      <ul>
        <li>An encrypted tunnel between client &amp; server</li>
        <li>Send HTTP traffic through the tunnel</li>
      </ul>
    </ul>
  </section>
  <section>
    <img src="./img/ssl.jpg" style="height: 75vh;">
  </section>
</section>
<section>
  <h2>References</h2>
  <ol>
    <li>Prof. Bahador Bakhshi Internet Eng.</li>
    <li>https://stackoverflow.com/questions/176264/what-is-the-difference-between-a-uri-a-url-and-a-urn</li>
    <li>https://cascadingmedia.com/insites/2015/03/http-2.html</li>
    <li>https://medium.com/hashmapinc/rest-good-practices-for-api-design-881439796dc9</li>
    <li>https://superuser.com/questions/97625/what-is-the-maximum-size-of-a-cookie-and-how-many-can-be-stored-in-a-browser-fo</li>
    <li>https://en.wikipedia.org/wiki/Base64</li>
    <li>https://en.wikipedia.org/wiki/Digest_access_authentication</li>
  </ol>
</section>
